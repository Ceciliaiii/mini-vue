# onCleanup & unwatch

## onCleanup
在 `watch` 或 `watchEffect` 中，通过 `onCleanup` 注册清理函数，用于在副作用执行前清理上一次的副作用残留：
```ts
watch(count, (newVal, oldVal, onCleanup) => {
  // 注册清理函数
  onCleanup(() => {
    console.log('清理上一次的副作用')
    // 实际场景：清除定时器、取消网络请求等
  })
  
  // 当前副作用逻辑
  console.log('处理新值:', newVal)
}, { immediate: true })
```
例子：清除定时器累积
```ts
watch(count, (val, _, onCleanup) => {
  const timer = setTimeout(() => {
    console.log('延迟执行:', val)
  }, 1000)
  onCleanup(() => clearTimeout(timer)) // 下次执行前清除上一次的定时器
})
```


## unwatch
停止 watch 监听：
```ts
// 1. 监听数据并获取unwatch方法
const unwatch = watch(count, (newVal, oldVal) => {
  console.log('count变化了:', newVal)
})

// 2. 在需要停止监听的时候调用
setTimeout(() => {
  unwatch() // 停止监听
  count.value = 100 // 此时不会触发上面的watch回调
}, 3000)
```
停止 watchEffect 监听：
```ts
const unwatch = watchEffect(() => {
  console.log('count值:', count.value)
})

// 停止监听
unwatch()
```