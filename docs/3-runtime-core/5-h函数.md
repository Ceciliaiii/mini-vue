# h函数

## `h`：参数处理和虚拟节点创建
`h(type, propsOrChildren?, children?)` 处理不同数量和类型的参数，最终统一调用 `createVnode` 生成虚拟节点。  
### 两个参数
```ts
 let l = arguments.length; // 获取参数数量

// 处理2个参数的情况
  if (l === 2) {

    // 如果第二个参数是对象且不是数组
    if (isObject(propsOrChildren) && !Array.isArray(propsOrChildren)) {

      // 第二个参数是虚拟节点（作为子节点）
      if (isVnode(propsOrChildren)) {

        return createVnode(type, null, [propsOrChildren]);
      } 
      else {

        // 第二个参数是属性      h('div', [{}, {}, ...])
        return createVnode(type, propsOrChildren);
      }
    } 
    else {

      // 第二个参数是子节点（数组或文本）
      return createVnode(type, null, propsOrChildren);
    }
  }
```

### 三个参数
```ts
// 处理3个及以上参数的情况
    if (l > 3) {

      // 超过3个参数时，从第3个开始都作为子节点
      children = Array.from(arguments).slice(2);
    } 
    else if (l === 3 && isVnode(children)) {

      // 第3个参数是单个虚拟节点，转为数组
      children = [children];
    }

    return createVnode(type, propsOrChildren, children);
```


## `createVnode`：创建虚拟节点
```ts
export function createVnode(type, props, children?) {
  // 确定节点类型（如元素节点）
  const shapeFlag = isString(type) ? ShapeFlags.ELEMENT : 0;

  const vnode = {
    __v_isVnode: true, // 标记为虚拟节点
    type, // 标签类型（如 'div'）
    props, // 属性
    children, // 子节点
    key: props?.key, // 用于diff算法的key
    el: null, // 对应的真实DOM节点
    shapeFlag // 节点类型标记（用于后续渲染判断）
  };

  // 设置子节点类型标记
  if (children) {
    if (Array.isArray(children)) {
      vnode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN; // 数组子节点
    } 
    else {
      children = String(children);
      vnode.shapeFlag |= ShapeFlags.TEXT_CHILDREN; // 文本子节点
    }
  }

  return vnode;
}
```
通过 `__v_isVnode` 标识判断是否为虚拟节点
```ts
export function isVnode(value) {
  return value?.__v_isVnode; // 存在该标识则为虚拟节点
}
```