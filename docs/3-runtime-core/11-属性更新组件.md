# 属性更新 vue 组件
父组件传递给子组件的 props 发生变化时，子组件响应并更新

## `processComponent` 流程总控
根据是否有旧节点（n1）判断是初始化还是更新：
```ts
const processComponent = (n1, n2, container, anchor) => {

  if (n1 == null) {
    // 无旧节点：首次渲染组件
    mountComponent(n2, container, anchor);
  } 
  else {
    // 有旧节点：更新组件
    updateComponent(n1, n2);
  }
};
```


## `updateComponent` 组件更新入口
```ts
const updateComponent = (n1, n2) => {
    
  // 复用组件实例（避免重新创建实例，保留组件状态）
  const instance = (n2.component = n1.component);

  // 获取新旧属性
  const { props: prevProps } = n1;
  const { props: nextProps } = n2;

  // 执行属性更新
  updateProps(instance, prevProps, nextProps);
};
```


## `updateProps` 更新组件属性
当检测到属性变化时，更新组件实例中的 props 数据，触发重渲染：
```ts
const updateProps = (instance, prevProps, nextProps) => {

  // 只有属性有变化时才执行更新
  if (hasPropsChange(prevProps, nextProps)) {

    // 用新属性 覆盖 旧属性
    for (let key in nextProps) {
      instance.props[key] = nextProps[key];
    }

    // 删除 新属性中 不存在的旧属性
    for (let key in instance.props) {
      if (!(key in nextProps)) {
        delete instance.props[key];
      }
    }
  }
};
```


## `hasPropsChange` 检测属性是否变化
首先判断新旧 props 是否有差异，只要有一处不同就返回 true，触发后续更新：
```ts
const hasPropsChange = (prevProps, nextProps) => {

  // 先比较属性数量：数量不同直接判定为变化
  let nKey = Object.keys(nextProps)
  if (nKey !== Object.keys(prevProps).length) {
    return true;
  }

  // 数量相同 则逐个比较属性值：有任何一个值不同就判定为变化
  for (let i = 0; i < nKey.length; i++) {
    const key = nKey[i];
    if (nextProps[key] !== prevProps[key]) {
      return true;
    }
  }

  // 所有属性都相同，无变化
  return false;
};
```
